<component name="dispatch" hier="dispatch">
	<interface name="clk" type="clock_sink">
		<signal type="clock">clk</signal>
	</interface>
	
	<interface name="reset" type="reset_sink">
		<signal type="reset">reset</signal>
	</interface>
	
	<interface name="out" type="send" clock="clk">
		<signal type="valid">o_valid</signal>
		<signal type="ready">i_ready</signal>
		<signal type="data" width="WIDTH">o_data</signal>
		<signal type="lp_id" width="1">o_lp</signal>
		
		<linkpoint name="unit_a" type="broadcast">1'b0</linkpoint>
		<linkpoint name="unit_b" type="broadcast">1'b1</linkpoint>
	</interface>
</component>

<component name="inverter" hier="inverter">
	<interface name="clk" type="clock_sink">
		<signal type="clock">clk</signal>
	</interface>
	
	<interface name="reset" type="reset_sink">
		<signal type="reset">reset</signal>
	</interface>
	
	<interface name="in" type="recv" clock="clk">
		<signal type="valid">i_valid</signal>
		<signal type="ready">o_ready</signal>
		<signal type="data" width="WIDTH">i_data</signal>
	</interface>
	
	<interface name="out" type="send" clock="clk">
		<signal type="valid">o_valid</signal>
		<signal type="ready">i_ready</signal>
		<signal type="data" width="WIDTH">o_data</signal>
	</interface>
</component>

<component name="xorer" hier="xorer">
	<interface name="clk" type="clock_sink">
		<signal type="clock">clk</signal>
	</interface>
	
	<interface name="reset" type="reset_sink">
		<signal type="reset">reset</signal>
	</interface>
	
	<interface name="in" type="recv" clock="clk">
		<signal type="valid">i_valid</signal>
		<signal type="ready">o_ready</signal>
		<signal type="data" width="WIDTH">i_data</signal>
		<signal type="lp_id" width="4">i_lp</signal>
		
		<linkpoint name="in0" type="broadcast">4'b1001</linkpoint>
		<linkpoint name="in1" type="broadcast">4'b0110</linkpoint>
	</interface>
	
	<interface name="out" type="send" clock="clk">
		<signal type="valid">o_valid</signal>
		<signal type="ready">i_ready</signal>
		<signal type="data" width="WIDTH">o_data</signal>
	</interface>
</component>

<component name="reverser" hier="reverser">
	<interface name="clk" type="clock_sink">
		<signal type="clock">clk</signal>
	</interface>
	
	<interface name="reset" type="reset_sink">
		<signal type="reset">reset</signal>
	</interface>
	
	<interface name="in" type="recv" clock="clk">
		<signal type="valid">i_valid</signal>
		<signal type="ready">o_ready</signal>
		<signal type="data" width="WIDTH">i_data</signal>
	</interface>
	
	<interface name="out" type="send" clock="clk">
		<signal type="valid">o_valid</signal>
		<signal type="ready">i_ready</signal>
		<signal type="data" width="WIDTH">o_data</signal>
	</interface>
</component>

<system name="inner">
	<instance name="the_dispatch" comp="dispatch">
		<defparam name="WIDTH" value="16"/>
	</instance>
	
	<instance name="the_inverter" comp="inverter">
		<defparam name="WIDTH" value="16"/>
	</instance>
	
	<instance name="the_reverser" comp="reverser">
		<defparam name="WIDTH" value="16"/>
	</instance>
	
	<instance name="xorro" comp="xorer">
		<defparam name="WIDTH" value="16"/>
	</instance>
	
	<export name="clk" type="clock_sink"/>
	<export name="reset" type="reset_sink"/>
	<export name="out" type="send"/>
	
	<link src="clk" dest="the_dispatch.clk"/>
	<link src="clk" dest="the_inverter.clk"/>
	<link src="clk" dest="the_reverser.clk"/>
	<link src="clk" dest="xorro.clk"/>
	<link src="reset" dest="the_dispatch.reset"/>
	<link src="reset" dest="the_inverter.reset"/>
	<link src="reset" dest="the_reverser.reset"/>
	<link src="reset" dest="xorro.reset"/>
	
	<link src="the_dispatch.out.unit_a" dest="the_inverter.in"/>
	<link src="the_dispatch.out.unit_b" dest="the_reverser.in"/>
	<link src="the_inverter.out" dest="xorro.in.in0"/>
	<link src="the_reverser.out" dest="xorro.in.in1"/>
	
	<link src="xorro.out" dest="out"/>
</system>

<system name="outer">
	<instance name="inner0" comp="inner"/>
	<instance name="inner1" comp="inner"/>
	<instance name="xoratio" comp="xorer">
		<defparam name="WIDTH" value="16"/>
	</instance>
	
	<export name="clk" type="clock_sink"/>
	<export name="reset" type="reset_sink"/>
	
	<link src="clk" dest="inner0.clk"/>
	<link src="clk" dest="inner1.clk"/>
	<link src="clk" dest="xoratio.clk"/>
	<link src="reset" dest="inner0.reset"/>
	<link src="reset" dest="inner1.reset"/>
	<link src="reset" dest="xoratio.reset"/>
	
	<link src="inner0.out" dest="xoratio.in.in0"/>
	<link src="inner1.out" dest="xoratio.in.in1"/>
</system>
